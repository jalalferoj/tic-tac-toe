<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roman Empire Tic Tac Toe</title>
<style>
  :root {
    --bg-day: linear-gradient(135deg, #f9f9f6, #e7e7e4);
    --bg-night: linear-gradient(135deg, #1c1c22, #2c2c34);
    --bg-legion: linear-gradient(135deg, #7a0f0f, #3d0505);
    --accent: gold;
    --cell-size: 28vmin;
    --gap: 2vmin;
  }
  body {
    margin: 0;
    font-family: 'Cinzel', serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    background: var(--bg-day);
    transition: background 0.5s;
  }
  header {
    width: 100%;
    padding: 1rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
    background: rgba(0,0,0,0.05);
    transition: opacity 0.5s;
  }
  header.hidden { opacity: 0; pointer-events: none; }
  header button {
    background: var(--accent);
    border: none;
    border-radius: 12px;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    cursor: pointer;
    font-weight: bold;
    color: #222;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    transition: transform 0.2s;
  }
  header button:hover { transform: scale(1.05); }
  .board {
    display: grid;
    grid-template-columns: repeat(3, var(--cell-size));
    grid-template-rows: repeat(3, var(--cell-size));
    gap: var(--gap);
    margin-top: 2rem;
  }
  .cell {
    background: rgba(255,255,255,0.7);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12vmin;
    font-weight: bold;
    color: #111;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    transition: background 0.3s, transform 0.2s;
  }
  .cell:hover { background: rgba(255,255,255,0.9); }
  .cell.winner { background: var(--accent); color: #222; }
  #status {
    margin-top: 1rem;
    font-size: 1.2rem;
    font-weight: bold;
  }
  #scoreboard {
    margin-top: 1rem;
    display: flex;
    gap: 2rem;
    font-weight: bold;
  }
  dialog {
    border: none;
    border-radius: 12px;
    padding: 1rem 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    max-width: 90vw;
  }
  dialog label { display: block; margin-top: 0.5rem; }
  #confetti {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
  }
</style>
</head>
<body>
  <header id="topbar">
    <button id="newRound">New Round</button>
    <button id="customize">Customize</button>
    <button id="resetScores">Reset Scores</button>
    <button id="fullscreen">Fullscreen</button>
  </header>
  <main>
    <div class="board" role="grid" aria-label="Tic Tac Toe Board">
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
      <div class="cell" role="gridcell" data-cell></div>
    </div>
    <div id="status" aria-live="polite">X's turn</div>
    <div id="scoreboard">
      <div>X: <span id="scoreX">0</span></div>
      <div>O: <span id="scoreO">0</span></div>
      <div>Draws: <span id="scoreDraw">0</span></div>
    </div>
  </main>

  <dialog id="customizeDialog">
    <h2>Customize Game</h2>
    <label>Theme:
      <select id="theme">
        <option value="day">Marble Day</option>
        <option value="night">Marble Night</option>
        <option value="legion">Legion</option>
      </select>
    </label>
    <label>Glyphs:
      <select id="glyphs">
        <option value="xo">X / O</option>
        <option value="roman">Gladius / Laurel</option>
      </select>
    </label>
    <label>Mode:
      <select id="mode">
        <option value="2p">2 Players</option>
        <option value="ai">vs AI</option>
      </select>
    </label>
    <label>First Move:
      <select id="firstMove">
        <option value="X">X</option>
        <option value="O">O</option>
      </select>
    </label>
    <label>AI Discipline:
      <select id="aiLevel">
        <option value="perfect">Perfect</option>
        <option value="pragmatic">Pragmatic</option>
        <option value="reckless">Reckless</option>
      </select>
    </label>
    <div style="margin-top:1rem; text-align:center;">
      <button id="apply">Apply</button>
      <button onclick="customizeDialog.close()">Cancel</button>
    </div>
  </dialog>

  <canvas id="confetti"></canvas>

<script>
  const cells = document.querySelectorAll('[data-cell]');
  const statusEl = document.getElementById('status');
  const scoreXEl = document.getElementById('scoreX');
  const scoreOEl = document.getElementById('scoreO');
  const scoreDrawEl = document.getElementById('scoreDraw');
  const customizeDialog = document.getElementById('customizeDialog');
  const themeSelect = document.getElementById('theme');
  const glyphsSelect = document.getElementById('glyphs');
  const modeSelect = document.getElementById('mode');
  const firstMoveSelect = document.getElementById('firstMove');
  const aiLevelSelect = document.getElementById('aiLevel');

  let currentPlayer = 'X';
  let board = Array(9).fill('');
  let scores = {X:0,O:0,Draw:0};
  let glyphs = {X:'X', O:'O'};
  let vsAI = false;
  let aiLevel = 'perfect';

  function startRound() {
    board.fill('');
    cells.forEach(c => { c.textContent=''; c.classList.remove('winner'); });
    currentPlayer = firstMoveSelect.value;
    statusEl.textContent = currentPlayer+"'s turn";
  }

  function checkWin(player) {
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    return wins.find(comb => comb.every(i => board[i]===player));
  }

  function handleClick(e) {
    const idx = [...cells].indexOf(e.target);
    if (board[idx]) return;
    board[idx] = currentPlayer;
    e.target.textContent = glyphs[currentPlayer];
    const win = checkWin(currentPlayer);
    if (win) {
      win.forEach(i => cells[i].classList.add('winner'));
      scores[currentPlayer]++; updateScores();
      statusEl.textContent = currentPlayer+" wins!";
      launchConfetti();
      return;
    }
    if (!board.includes('')) {
      scores.Draw++; updateScores();
      statusEl.textContent = "Draw!";
      return;
    }
    currentPlayer = currentPlayer==='X'?'O':'X';
    statusEl.textContent = currentPlayer+"'s turn";
    if (vsAI && currentPlayer==='O') aiMove();
  }

  function updateScores(){
    scoreXEl.textContent = scores.X;
    scoreOEl.textContent = scores.O;
    scoreDrawEl.textContent = scores.Draw;
  }

  function aiMove(){
    let move;
    if (aiLevel==='reckless') {
      const empty = board.map((v,i)=>v?null:i).filter(v=>v!==null);
      move = empty[Math.floor(Math.random()*empty.length)];
    } else {
      move = bestMove();
      if (aiLevel==='pragmatic' && Math.random()<0.3) {
        const empty = board.map((v,i)=>v?null:i).filter(v=>v!==null);
        move = empty[Math.floor(Math.random()*empty.length)];
      }
    }
    board[move]='O';
    cells[move].textContent = glyphs.O;
    const win = checkWin('O');
    if (win) {
      win.forEach(i => cells[i].classList.add('winner'));
      scores.O++; updateScores();
      statusEl.textContent = "O wins!";
      launchConfetti();
      return;
    }
    if (!board.includes('')) {
      scores.Draw++; updateScores();
      statusEl.textContent = "Draw!";
      return;
    }
    currentPlayer='X';
    statusEl.textContent="X's turn";
  }

  function bestMove(){
    let bestScore=-Infinity, move;
    board.forEach((v,i)=>{
      if(!v){
        board[i]='O';
        let score=minimax(board,0,false);
        board[i]='';
        if(score>bestScore){bestScore=score; move=i;}
      }
    });
    return move;
  }
  function minimax(b,depth,isMax){
    if(checkWin('O')) return 10-depth;
    if(checkWin('X')) return depth-10;
    if(!b.includes('')) return 0;
    if(isMax){
      let best=-Infinity;
      b.forEach((v,i)=>{
        if(!v){
          b[i]='O';
          best=Math.max(best,minimax(b,depth+1,false));
          b[i]='';
        }
      });
      return best;
    } else {
      let best=Infinity;
      b.forEach((v,i)=>{
        if(!v){
          b[i]='X';
          best=Math.min(best,minimax(b,depth+1,true));
          b[i]='';
        }
      });
      return best;
    }
  }

  cells.forEach(c=>c.addEventListener('click',handleClick));
  document.getElementById('newRound').onclick=startRound;
  document.getElementById('resetScores').onclick=()=>{
    scores={X:0,O:0,Draw:0}; updateScores(); startRound();
  };
  document.getElementById('customize').onclick=()=>customizeDialog.showModal();
  document.getElementById('apply').onclick=()=>{
    if(themeSelect.value==='day') document.body.style.background= 'var(--bg-day)';
    if(themeSelect.value==='night') document.body.style.background= 'var(--bg-night)';
    if(themeSelect.value==='legion') document.body.style.background= 'var(--bg-legion)';
    glyphs = glyphsSelect.value==='xo'?{X:'X',O:'O'}:{X:'\u2694',O:'\u27BF'};
    vsAI = (modeSelect.value==='ai');
    aiLevel = aiLevelSelect.value;
    customizeDialog.close();
    startRound();
  };
  document.getElementById('fullscreen').onclick=()=>{
    if(!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  };

  // auto-hide header
  const topbar=document.getElementById('topbar');
  let hideTimeout;
  function scheduleHide(){
    clearTimeout(hideTimeout);
    hideTimeout=setTimeout(()=>topbar.classList.add('hidden'),3000);
  }
  document.addEventListener('mousemove',()=>{topbar.classList.remove('hidden'); scheduleHide();});
  document.addEventListener('touchstart',()=>{topbar.classList.remove('hidden'); scheduleHide();});
  scheduleHide();

  // confetti
  const canvas=document.getElementById('confetti');
  const ctx=canvas.getContext('2d');
  let confetti=[];
  function resize(){canvas.width=innerWidth; canvas.height=innerHeight;}
  window.addEventListener('resize',resize); resize();
  function launchConfetti(){
    if(window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    confetti=Array.from({length:200},()=>({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height- canvas.height,
      r:5+Math.random()*5,
      c:`hsl(${Math.random()*360},100%,50%)`,
      v:2+Math.random()*3
    }));
    requestAnimationFrame(drawConfetti);
  }
  function drawConfetti(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(p=>{
      p.y+=p.v;
      if(p.y>canvas.height) p.y=-10;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,2*Math.PI); ctx.fillStyle=p.c; ctx.fill();
    });
    if(confetti.length) requestAnimationFrame(drawConfetti);
  }

  startRound();
</script>
</body>
</html>
